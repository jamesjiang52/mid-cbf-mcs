@startuml
'https://plantuml.com/sequence-diagram

skinparam backgroundColor #EEEBDC
skinparam sequence {
  ParticipantBorderColor DodgerBlue
  ParticipantBackgroundColor DeepSkyBlue
  ActorBorderColor DarkGreen
  ActorBackgroundColor Green
  BoxBorderColor LightBlue
  BoxBackgroundColor #F0FFFF
}
skinparam collections {
  BackGroundColor LightBlue
  BorderColor DodgerBlue
}
skinparam database {
  BackgroundColor LightGreen
  BorderColor DarkGreen
}

title Restart Command Sequence - Correlation\n

participant "CSP_Mid\n.LMC" as lmc #Thistle
box "\nMCS\n"
  participant "Mid.CBF\nSubarray" as subarray
  collections "VCC\n" as vcc
  collections "FSP\n" as fsp
  collections "FSP Corr\nSubarray" as fspsubarray
end box
box "\nHPS\n"
  participant "VCC\nController" as hpsvcc
  participant "VCC\nBand1&2" as hpsvccband
  participant "FSP\nController" as hpsfsp
  participant "FSP Corr\nController" as hpsfsp_corr
end box

lmc         ->  subarray      : Restart

group #SeaShell If ObsState == FAULT:
  subarray    ->  vcc           : Abort
  vcc         ->  hpsvccband    : Abort (stub)
  subarray    <--  vcc          : Success
  note over hpsvccband          : (TBD)
  note over vcc                 : ObsState: ABORTED
  subarray    ->  fspsubarray   : Abort
  fspsubarray ->  hpsfsp_corr   : Abort (stub)
  note over hpsfsp_corr         : (TBD)
  note over fspsubarray         : ObsState: ABORTED
  subarray    <--  fspsubarray  : Success
end group

subarray    ->  vcc           : ObsReset
vcc         ->  hpsvccband    : ObsReset (stub)
note over hpsvccband          : (TBD)
note over vcc                 : ObsState: IDLE
subarray    <--  vcc          : Success

subarray    ->  fspsubarray   : ObsReset
fspsubarray ->  hpsfsp_corr   : ObsReset (stub)
note over hpsfsp_corr         : (TBD)
note over fspsubarray         : ObsState: IDLE
subarray    <--  fspsubarray  : Success

group #LightCyan For each FSP:
  subarray    -> fsp          : RemoveSubarrayMembership
  note over hpsfsp            : functionMode: IDLE
  group #SeaShell If no other subarray membership:
    fsp       ->  fspsubarray : AdminMode.OFFLINE
  end group
end group

subarray    <--  fsp          : Success
note over subarray            : ObsState: IDLE

group #LightCyan For each assigned receptor:
  subarray    ->  vcc           : subarrayMembership = 0
  subarray    ->  vcc           : AdminMode.OFFLINE
end group

note over subarray            : ObsState: EMPTY
lmc         <--  subarray     : Success


@enduml