@startuml
'https://plantuml.com/sequence-diagram

skinparam backgroundColor #EEEBDC
skinparam sequence {
  ParticipantBorderColor DodgerBlue
  ParticipantBackgroundColor DeepSkyBlue
  ActorBorderColor DarkGreen
  ActorBackgroundColor Green
  BoxBorderColor LightBlue
  BoxBackgroundColor #F0FFFF
}
skinparam collections {
  BackGroundColor LightBlue
  BorderColor DodgerBlue
}
skinparam database {
  BackgroundColor LightGreen
  BorderColor DarkGreen
}

title ObsReset Command Sequence - Correlation\n

participant "CSP_Mid\n.LMC" as lmc #Thistle
box "\nMCS\n"
  participant "Mid.CBF\nSubarray" as subarray
  collections "VCC\n" as vcc
  collections "FSP\n" as fsp
  collections "FSP Corr\nSubarray" as fspsubarray
end box
box "\nHPS\n"
  participant "VCC\nController" as hpsvcc
  participant "VCC\nBand1&2" as hpsvccband
  participant "FSP\nController" as hpsfsp_cont  
  participant "FSP Corr\nController" as hpsfsp
end box

lmc         ->  subarray      : ObsReset

group #SeaShell If ObsState == FAULT:
  subarray    ->  vcc           : Abort
  vcc         ->  hpsvccband    : Abort (stub)
  subarray    <--  vcc          : Success
  note over hpsvccband          : (TBD)
  note over vcc                 : ObsState: ABORTED
  subarray    ->  fspsubarray   : Abort
  fspsubarray ->  hpsfsp        : Abort (stub)
  note over hpsfsp              : (TBD)
  note over fspsubarray         : ObsState: ABORTED
  subarray    <--  fspsubarray  : Success
end group

subarray    ->  vcc           : ObsReset
vcc         ->  hpsvccband    : ObsReset (stub)
note over hpsvccband          : (TBD)
note over vcc                 : ObsState: IDLE
subarray    <--  vcc          : Success

subarray    ->  fspsubarray   : ObsReset
fspsubarray ->  hpsfsp        : ObsReset (stub)
note over hpsfsp              : (TBD)
note over fspsubarray         : ObsState: IDLE
subarray    <--  fspsubarray  : Success

group #LightCyan For each FSP:
    subarray    -> fsp          : RemoveSubarrayMembership
    note over hpsfsp_cont       : functionMode: IDLE
    group #SeaShell If no other subarray membership:
      fsp       ->  fspsubarray : AdminMode.OFFLINE
    end group
end group

subarray    <--  fsp          : Success

note over subarray            : ObsState: IDLE
lmc        <--  subarray      : Success


@enduml