@startuml
'https://plantuml.com/sequence-diagram

skinparam backgroundColor #EEEBDC
skinparam sequence {
ParticipantBorderColor DodgerBlue
ParticipantBackgroundColor DeepSkyBlue
ActorBorderColor DarkGreen
ActorBackgroundColor Green
BoxBorderColor LightBlue
BoxBackgroundColor #F0FFFF
}

title MCS Correlation Configure Scan Band 1 - VCC Detail\n

participant "CSP_Mid\n.LMC" as lmc

box "MCS"
participant "Mid.CBF\nSubarray" as subarray
participant "VCC\n" as vcc
participant "FSP\n" as fsp
end box

box "HPS"
participant "HPS VCC\nController" as hpsvcc
participant "HPC VCC\nBand1&2" as vccband1
participant "Circuit\nSwitch" as cs
participant "VCC\n" as vccdevice
participant "Wide Band\nInput Buffer" as wb
end box

lmc         -> subarray     : ConfigureScan(json_str)
subarray    -> fsp          : Deconfigure
subarray    -> subarray     : Calc dish_sample_rate
note right                  : dish_sample_rate (Band 1/2) = 3960 MHz + (1 * K * <U+0394>F)
subarray    -> vcc          : ConfigureBand(json_str)
vcc         -> hpsvcc       : ConfigureBand(int)
hpsvcc      -> vccband1     : On
vcc         -> vccband1     : SetInternalParameters(json_str)
vccband1    -> vccdevice    : write_attribute(gain)
subarray    -> vcc          : ConfigureScan(json_str)
vcc         -> vccband1     : ConfigureScan(json_str)
vccband1    -> vccband1     : State Transition: CONFIGURE_INVOKED
vccband1    -> cs           : write_attribute(input_select)
note right                  : stream_rate = dish_sample_rate / 18
vccband1    -> vccdevice    : write_attribute(frame_count)
note right                  : frame_count = stream_rate
vccband1    -> wb           : write_attributes(stream_rate, packet_rate, etc)
vccband1    -> vccband1     : Sleep(2s)
vccband1    -> vccband1     : Verify configuration (Compare dish IDs, sample rates)
vccband1    -> vccband1     : State Transition: CONFIGURE_COMPLETED
vcc         -> vcc          : Ready
subarray    -> subarray     : Ready


@enduml