@startuml
'https://plantuml.com/sequence-diagram

skinparam backgroundColor #EEEBDC
skinparam sequence {
ParticipantBorderColor DodgerBlue
ParticipantBackgroundColor DeepSkyBlue
ActorBorderColor DarkGreen
ActorBackgroundColor Green
BoxBorderColor LightBlue
BoxBackgroundColor #F0FFFF
}

title TMC and Mid_CBF.LMC Scan Sequence - High Level

participant "TMC\n" as tmc #Gold
participant "CSP_Mid\n.LMC" as lmc #Thistle

box "\nMCS\n"
participant "Mid.CBF\nController" as controller
participant "Mid.CBF\nSubarray" as subarray
end box

note over controller        : OpState: ON
lmc         -> subarray     : AddReceptors(strs)
subarray    -> subarray     : ObsState: IDLE
subarray   --> lmc          : Success
lmc         -> subarray     : ConfigureScan(json_str)
subarray    -> tmc          : unsubscribe all events

group #LemonChiffon Delay model subscription point
subarray    -> tmc          : Subscribe delay model
end group

' group Doppler subscription point
' subarray    -> tmc          : subscribe Doppler phase correction
' end group

' group Jones matrix subscription point
' subarray    -> tmc          : subscribe Jones matrix
' end group

' group Timing beam subscription point
' subarray    -> tmc          : subscribe timing beam weights
' end group

subarray    -> subarray     : ObsState: READY
subarray   --> lmc          : Success

lmc         -> subarray     : Scan()
subarray    -> subarray     : ObsState: SCANNING
subarray   --> lmc          : Success

lmc         -> subarray     : EndScan()
subarray    -> subarray     : ObsState: READY
subarray   --> lmc          : Success

lmc         -> subarray     : GoToIdle()
subarray    -> subarray     : ObsState: IDLE
subarray   --> lmc          : Success

lmc         -> subarray     : RemoveAllReceptors()
subarray    -> subarray     : ObsState: EMPTY
subarray   --> lmc          : Success

@enduml